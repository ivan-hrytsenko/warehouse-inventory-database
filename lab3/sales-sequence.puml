@startuml
autonumber
skinparam style strictuml

' Participant
actor "Inventory Clerk" as Clerk
boundary ":SalesUI" as UI
control ":TransactionManager" as Manager
database ":ProductRepository" as DB
actor ":PaymentGateway" as PG
control ":AuditLogger" as Logger

== Initialization ==

Clerk -> UI : inputTransaction(sku, quantity)
activate UI

UI -> Manager : processSale(sku, quantity)
activate Manager

Manager -> DB : getProductBySKU(sku)
activate DB
DB --> Manager : productData (price, current_stock)
deactivate DB

== Processing ==

alt stock available
    Manager -> PG : requestPayment(amount)
    activate PG
    
    alt success
        PG --> Manager : successToken
        
        Manager -> DB : updateStock(sku, -quantity)
        activate DB
        DB --> Manager : confirmed
        deactivate DB
        
        Manager -> Logger : recordAudit(clerkId, action, status)
        activate Logger
        Logger --> Manager : ok
        deactivate Logger
        
        Manager --> UI : transactionComplete(receipt)
        UI --> Clerk : showSuccess()
        
    else #pink payment failed
        PG --> Manager : error
        deactivate PG
        Manager --> UI : showError("Payment Declined")
        UI --> Clerk : notifyUser("Failed")
    end
    
else #pink out of stock
    Manager --> UI : showError("No Stock")
    deactivate Manager
    UI --> Clerk : notifyUser("Try again")
    deactivate UI
end

@enduml